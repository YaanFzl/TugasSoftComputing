{% extends "base.html" %}

{% block title %}Logika Fuzzy - Soft Computing{% endblock %}

{% block content %}
<div class="glass-card">
    <h1>‚òÅÔ∏è Simulator Logika Fuzzy</h1>
    <p>Eksplorasi penalaran mesin dengan konsep samar menggunakan metode Mamdani dan Sugeno.</p>

    <div style="margin-top: 2rem;">
        <button class="btn-glow" onclick="showTab('mamdani')">Mamdani (Tipping)</button>
        <button class="btn-glow" onclick="showTab('sugeno')"
            style="background: transparent; border: 1px solid var(--secondary-color);">Sugeno (Produksi)</button>
    </div>
</div>

<!-- Mamdani Section -->
<div id="mamdani-section">
    <div class="grid">
        <div class="glass-card">
            <h2>üçΩÔ∏è Masalah Tipping (Mamdani)</h2>
            <p>Hitung jumlah tip berdasarkan Kualitas Makanan dan Pelayanan.</p>

            <div style="margin-top: 2rem;">
                <label>Kualitas Makanan (0-10)</label>
                <input type="range" id="quality" min="0" max="10" step="0.1" value="5"
                    oninput="updateVal('q-val', this.value)">
                <span id="q-val" style="float: right;">5</span>

                <label style="margin-top: 1rem; display: block;">Pelayanan (0-10)</label>
                <input type="range" id="service" min="0" max="10" step="0.1" value="5"
                    oninput="updateVal('s-val', this.value)">
                <span id="s-val" style="float: right;">5</span>

                <button class="btn-glow" style="margin-top: 2rem; width: 100%;" onclick="calculateTip()">Hitung
                    Tip</button>
            </div>
        </div>

        <div class="glass-card">
            <h2>üí° Hasil</h2>
            <div style="text-align: center; margin-top: 2rem;">
                <h3 style="color: var(--secondary-color); font-size: 2rem;" id="tip-result">0%</h3>
                <p>Rekomendasi Tip</p>
            </div>

            <div
                style="margin-top: 2rem; background: rgba(255,255,255,0.1); height: 20px; border-radius: 10px; overflow: hidden;">
                <div id="tip-bar"
                    style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); transition: width 0.5s ease;">
                </div>
            </div>
        </div>
    </div>

    <div class="glass-card">
        <h2>üìö Teori: Inferensi Mamdani</h2>
        <p>Metode Mamdani adalah metodologi fuzzy yang paling banyak digunakan. Melibatkan:</p>
        <ol style="margin-left: 1.5rem; margin-top: 1rem;">
            <li><b>Fuzzifikasi:</b> Mengubah input tegas menjadi himpunan fuzzy.</li>
            <li><b>Evaluasi Aturan:</b> Menerapkan aturan IF-THEN.</li>
            <li><b>Agregasi:</b> Menggabungkan output dari semua aturan.</li>
            <li><b>Defuzzifikasi:</b> Mengubah output fuzzy kembali menjadi nilai tegas (biasanya Centroid).</li>
        </ol>
    </div>
</div>

<!-- Sugeno Section -->
<div id="sugeno-section" style="display: none;">
    <div class="grid">
        <div class="glass-card">
            <h2>üè≠ Prediksi Produksi (Sugeno)</h2>
            <p>Optimalkan produksi berdasarkan Permintaan dan Stok (Orde-0).</p>
            <div style="margin-top: 2rem;">
                <label>Permintaan (0-5000)</label>
                <input type="range" id="demand" min="0" max="5000" step="100" value="4000"
                    oninput="updateVal('d-val', this.value)">
                <span id="d-val" style="float: right;">4000</span>

                <label style="margin-top: 1rem; display: block;">Stok (0-500)</label>
                <input type="range" id="stock" min="0" max="500" step="10" value="300"
                    oninput="updateVal('s-val', this.value)">
                <span id="s-val" style="float: right;">300</span>

                <button class="btn-glow" style="margin-top: 2rem; width: 100%;" onclick="calculateProduction()">Prediksi
                    Produksi</button>
            </div>
        </div>

        <div class="glass-card">
            <h2>üìä Prediksi</h2>
            <div style="text-align: center; margin-top: 2rem;">
                <h3 style="color: var(--tertiary-color); font-size: 2rem;" id="prod-result">0 Unit</h3>
                <p>Rekomendasi Produksi</p>
            </div>

            <div style="margin-top: 2rem;">
                <h4>Kekuatan Aturan (Alpha)</h4>
                <ul id="alpha-list"
                    style="list-style: none; padding: 0; margin-top: 1rem; color: rgba(255,255,255,0.7);">
                    <li>Jalankan prediksi untuk melihat detail...</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="glass-card">
        <h2>üìö Teori: Metode Sugeno</h2>
        <p>Inferensi fuzzy Sugeno mirip dengan Mamdani tetapi menggunakan fungsi singleton (konstanta) atau linear untuk
            outputnya. Ini efisien secara komputasi dan bekerja dengan baik dengan teknik optimasi dan adaptif.</p>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    function showTab(tab) {
        document.getElementById('mamdani-section').style.display = tab === 'mamdani' ? 'block' : 'none';
        document.getElementById('sugeno-section').style.display = tab === 'sugeno' ? 'block' : 'none';
    }

    function updateVal(id, val) {
        document.getElementById(id).innerText = val;
    }

    async function calculateTip() {
        const quality = document.getElementById('quality').value;
        const service = document.getElementById('service').value;

        const response = await fetch('/api/fuzzy/tipping', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                quality: Number(quality),
                service: Number(service)
            })
        });

        const data = await response.json();
        const tip = data.tip.toFixed(2);

        document.getElementById('tip-result').innerText = tip + '%';
        document.getElementById('tip-bar').style.width = (tip / 25 * 100) + '%';
    }

    async function calculateProduction() {
        const demand = document.getElementById('demand').value;
        const stock = document.getElementById('stock').value;

        const response = await fetch('/api/sugeno/predict', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                demand: Number(demand),
                stock: Number(stock)
            })
        });

        const data = await response.json();

        document.getElementById('prod-result').innerText = data.production + ' Unit';

        const list = document.getElementById('alpha-list');
        list.innerHTML = '';
        for (const [rule, alpha] of Object.entries(data.alphas)) {
            const li = document.createElement('li');
            li.innerHTML = `<div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
            <span>${rule}</span>
            <span style="color: var(--secondary-color);">${alpha.toFixed(2)}</span>
        </div>
        <div style="background: rgba(255,255,255,0.1); height: 5px; border-radius: 5px;">
            <div style="width: ${alpha * 100}%; height: 100%; background: var(--tertiary-color);"></div>
        </div>`;
            list.appendChild(li);
        }
    }
</script>
{% endblock %}